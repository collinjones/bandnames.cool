{% extends 'bnSubmission/base.html' %}

{% block title %} {{ title }} {% endblock %}

{% block body %}

<center>
{% if user.is_authenticated %}
    Hi {{ user.username }}!
    <p><a href="{% url 'logout' %}">Log Out</a></p>
{% else %}
    <p>You are not logged in</p>
    <a href="{% url 'login' %}">Log In</a>
    <a href="{% url 'signup' %}">Sign Up</a>
{% endif %}
</center>



<center>
    <script>
        var wheel;
        var bn_arr;

        class Wheel {
            
            constructor(position, radius, color, bandnames) {
                this.position = position
                this.radius = radius;
                this.color = color;
                this.angle = 0;
                this.angleV = 0.01;
                this.angleA = 0;
                this.bandnames = bandnames
                this.bandnamesOnWheel = []

                for (var i = 0; i < this.bandnames.length; i++) {
                    if (this.bandnamesOnWheel.length > 30) {
                        break;
                    }
                    this.bandnamesOnWheel.push(this.bandnames[i])
                }
            }

            update() {
                translate(0, height/2);
                rotate(this.angle);
                this.render();
                
                translate(0, -height/2);
                
            }

            render() {
                fill(this.color["levels"][0], this.color["levels"][1], this.color["levels"][2])
                ellipse(this.position.x, this.position.y, this.radius)
                textSize(32);
                fill(0, 0, 0, 255)

                for (var i = 0; i < this.bandnamesOnWheel.length; i++) {
                    text(this.bandnamesOnWheel[i], 150, 10)
                    rotate(0.2)
                }
                
               
            }

        };

        function setup() {
            var canvas = createCanvas(800, 400);
            canvas.parent('sketch-holder');
            angleMode(RADIANS);
            ellipseMode(CENTER);
            background(255)
            frameRate(60);

            var bandnames = "{{ bandnames|safe }}"
            bn_arr = bandnames.split(',')
            

            for (var i = 0; i < bn_arr.length; i++) {
                bn_arr[i] = bn_arr[i].slice(12)
                bn_arr[i] = bn_arr[i].slice(0, -1)

                if (i == bn_arr.length - 1) {
                    bn_arr[i] = bn_arr[i].slice(0, -1)
                }
            }

            var random_name = bn_arr[Math.floor(Math.random() * bn_arr.length)]
            wheel = new Wheel(createVector(0, 0), 1000, color(255, 204, 0), bn_arr)

        }

        function draw() {
            background(255)
            wheel.update();
            wheel.angle += wheel.angleV;
            wheel.angleV += wheel.angleA;
            
        }

    </script>
</center>

<center>

    <div id = "sketch-holder" style="touch-action:none">

    </div>
    
    <div id = "submission-form" style="font-family: Pixelated" >
        <h2 id='submission-status'></h2>
        <form enctype="multipart/form-data" method="post" id="post-form">
            <h3> Submit a bandname </h3>
            {% csrf_token %}
            {{form}}
            <button name="submit" style="font-family: Pixelated; margin: 5px;" type="submit" value="Submit">Submit Bandname</button>
        </form>

        <form id="refresh-button">
            <button style="font-family: Pixelated; margin: 5px;" >Refresh Bandnames</button><br>
        </form>
    </div>
    <table style="font-family: Pixelated;" id="bandnames-table">
        <thead>
            <tr>
                <th>Bandname</th>
                <th>Upvotes</th>
                <th>Downvotes</th>
            </tr>
        </thead>

        {% for bandname in bandnames_reversed %}
        <tbody id="bandnames-table-body">
            </tr>
                <td class="tooltip">{{bandname.bandname}}
                    <span class="tooltiptext">{{bandname.username}}</span>
                </td>
                <td>{{bandname.upvotes}}</td>
                <td>{{bandname.downvotes}}</td>
            </tr>
        </tbody>
        {% endfor %}

    </table>
</center>

{% endblock %}